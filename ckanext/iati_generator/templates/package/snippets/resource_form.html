{% ckan_extends %}

{% block metadata_fields %}
  {{ super() }}
<p>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</p>

  {# Prefill desde extras #}
  {% set ex = h.extras_as_dict(data.extras) if data and data.extras else {} %}
  {% set ns_val = ex.get('iati_namespace','') %}
  {% set ref_val = ex.get('iati_file_reference','') %}

  <section class="module module-narrow">
    <h3 class="module-heading">{{ _("IATI") }}</h3>
    <div class="module-content">
      <p class="help-block">
        {{ _("If this resource must be used to build the final XML IATI file, define how. It's not required to make this dataset public.") }}
      </p>

      <div class="control-group">
        <label class="control-label" for="field-iati-namespace">{{ _("IATI namespace") }}</label>
        <div class="controls">
          <input type="text" id="field-iati-namespace" name="iati_namespace"
                 value="{{ ns_val }}" maxlength="90" class="control-full"
                 placeholder="{{ _('eg. XM-DAC-46002 or my-org') }}">
          <p class="info-block info-block-small">
            <i class="fa fa-info-circle"></i>
            {{ _("Leave empty for a single IATI file environment.") }}
          </p>
        </div>
      </div>

      <div class="control-group">
        <label class="control-label" for="field-iati-file-reference">{{ _("IATI file reference") }}</label>
        <div class="controls">
          {# Llamamos directo al helper (no uses "in h") #}
          {% set opts = h.get_iati_file_reference_options() or [] %}
          {% if opts %}
            <select id="field-iati-file-reference" name="iati_file_reference" class="control-medium">
              <option value="">{{ _("- Select -") }}</option>
              {% for o in opts %}
                <option value="{{ o.value }}" {% if o.value == ref_val %}selected{% endif %}>{{ o.text }}</option>
              {% endfor %}
            </select>
          {% else %}
            <input type="text" id="field-iati-file-reference" name="iati_file_reference"
                   value="{{ ref_val }}" class="control-medium"
                   placeholder="{{ _('eg. activities / transactions / ...') }}">
          {% endif %}

          <p class="info-block info-block-small">
            <i class="fa fa-info-circle"></i>
            {{ _("Choose the reference from the IATI enums list.") }}
          </p>
        </div>
      </div>
    </div>
  </section>
{% endblock %}
